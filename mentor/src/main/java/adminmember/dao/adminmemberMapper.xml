<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="adminmemberSQL">
 
 <!-- íšŒì›ë“¤ ë½‘ì•„ì˜¤ê¸° -->
 <select id="getAdminmemberList" parameterType="java.util.Map" resultType="adminmember">
 	<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			member_seq,
			member_name,
			member_nickname,
			member_email,
			member_flag,
			member_profile,
			to_char(logtime,'YYYY-MM-DD') logtime
	 from mentors_member
	 order by logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>
 
 <!-- íšŒì›ë¶„ë¥˜ -->
 <select id="memberClassfication" parameterType="java.util.Map" resultType="adminmember">
 	select * from
	(select rownum rn, tt.*from
	(select 
			member_seq,
			member_name,
			member_nickname,
			member_email,
			member_flag,
			member_profile,
			to_char(logtime,'YYYY-MM-DD') logtime
	 from mentors_member
	  <if test="state == 1">
	 	order by member_flag desc)tt)
	 </if>
	 <if test="state == 2">
	 	order by member_flag)tt)
	 </if>
	 <![CDATA[where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>

 <!-- ì´íšŒì› ë½‘ì•„ã…‹ì˜¤ê¸° -->
 <select id="getMemeberTotalA" resultType="Integer">
		select count(*) cnt from mentors_member
</select>
<!-- íšŒì›ê²€ìƒ‰ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchadminmemberList" parameterType="java.util.Map" resultType="adminmember">
<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			member_seq,
			member_name,
			member_nickname,
			member_email,
			member_flag,
			member_profile,
			to_char(logtime,'YYYY-MM-DD') logtime
	 from mentors_member
	 where member_name like '%'||#{adminmemberKeyword}||'%'
	 order by logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>
</select>
<!-- íšŒì›ê²€ìƒ‰ ì´ ë©¤ë²„ ìˆ˜ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchmemeberTotalA" parameterType="java.util.Map" resultType="int">
	select count(*) from mentors_member where member_name like '%'||#{adminmemberKeyword}||'%'
</select>

 <!-- ë©¤ë²„ì‚­ì œ -->
<delete id="deleteMember" parameterType="java.util.Map">
	delete mentors_member where member_seq in
		<foreach collection="check" item="member_seq" index="i" open="(" close=")" separator=",">
			#{member_seq}<!-- ${check[i]} ì»¬ë ‰ì…˜ë§Œ $ë¨¹ê³  itemì¸ seqëŠ” #ê³¼$ê°™ì´ë¨¹ëŠ”ë‹¤ -->
		</foreach>
</delete>

<!-- ë©˜í† ë½‘ì•„ì˜¤ê¹… -->
 <select id="getAdminmentorList" parameterType="java.util.Map" resultType="adminmentor">
 	<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			mt.mentor_seq,
			mm.member_name,
			mt.mentor_company,
			mt.mentor_department,
			j.job_type,
			mt.mentor_badge,
			mm.member_profile,
			to_char(mt.mentor_logtime,'YYYY-MM-DD') mentor_logtime
	 from mentors_member mm, 
	 	  mentor mt,
	 	  job j 
	 where mm.member_email = mt.mentor_email
	 and   mt.job_code = j.job_code
	 and mt.mentor_flag = 1
	 order by mt.mentor_logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>
 <!-- ë©˜í† ë¶„ë¥˜ -->
 <select id="mentorClassfication" parameterType="java.util.Map" resultType="adminmentor">
 	select * from
	(select rownum rn, tt.*from
	(select 
			mt.mentor_seq,
			mm.member_name,
			mt.mentor_company,
			mt.mentor_department,
			j.job_type,
			mt.mentor_badge,
			mm.member_profile,
			to_char(mt.mentor_logtime,'YYYY-MM-DD') mentor_logtime
	 from mentors_member mm, 
	 	  mentor mt,
	 	  job j 
	 where mm.member_email = mt.mentor_email
	 and   mt.job_code = j.job_code
	 and mt.mentor_flag = 1
	 <if test="state == 1">
	 	order by mt.mentor_badge desc)tt)
	 </if>
	 <if test="state == 2">
	 	order by mt.mentor_badge)tt)
	 </if>
	<![CDATA[ where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>
 
 <!-- ì´ë©˜í†  -->
 <select id="getMentorTotalA" resultType="Integer">
		select count(*) cnt from mentor where mentor_flag = 1
</select>

<!-- ë©˜í† ê²€ìƒ‰ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchadminmentorList" parameterType="java.util.Map" resultType="adminmentor">
	<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			mt.mentor_seq,
			mm.member_name,
			mt.mentor_company,
			mt.mentor_department,
			j.job_type,
			mt.mentor_badge,
			mm.member_profile,
			to_char(mt.mentor_logtime,'YYYY-MM-DD') mentor_logtime
	 from mentors_member mm, 
	 	  mentor mt,
	 	  job j 
	 where mm.member_email = mt.mentor_email
	 and   mt.job_code = j.job_code
	 and mt.mentor_flag = 1
	 and mm.member_name like '%'||#{adminmentorKeyword}||'%'
	 order by mt.mentor_logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>	 
</select>
<!-- ë©˜í† ê²€ìƒ‰ ì´ ë©¤ë²„ ìˆ˜ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchmentorTotalA" parameterType="java.util.Map" resultType="int">
	select count(*) 
	from mentor mt,
		 mentors_member mm
	where mm.member_email = mt.mentor_email
	and mt.mentor_flag = 1
	and mm.member_name like '%'||#{adminmentorKeyword}||'%'
</select>

<!-- ë©˜í† ì‹ ì²­ ë½‘ì•„ì˜¤ê¹… -->
 <select id="getAdminmentorApplyList" parameterType="java.util.Map" resultType="adminmentor">
 	select * from
	(select rownum rn, tt.*from
	(select 
			mm.member_seq,
			mt.mentor_seq,
			mm.member_name,
			mt.mentor_company,
			mt.mentor_department,
			j.job_type,
			mt.mentor_flag,
			mm.member_profile,
			to_char(mt.mentor_logtime,'YYYY-MM-DD') mentor_logtime
	 from mentors_member mm, 
	 	  mentor mt,
	 	  job j 
	 where mm.member_email = mt.mentor_email
	 and   mt.job_code = j.job_code
	 and mt.mentor_flag = 0
	 order by mt.mentor_logtime desc)tt) 
	 <![CDATA[
	 where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>
 
 <!-- ì´ë©˜í† ì‹ ì²­ ë½‘ì•„ì˜¤ê¹…-->
 <select id="getMentorApplyTotalA" resultType="Integer">
		select count(*) cnt from mentor where mentor_flag = 0
</select>

<!-- ë©˜í† ì‹ ì²­ê²€ìƒ‰ ë½‘ì•„ì˜¤ê¹… -->
 <select id="getSearchadminmentorApplyList" parameterType="java.util.Map" resultType="adminmentor">
 	select * from
	(select rownum rn, tt.*from
	(select 
			mt.mentor_seq,
			mm.member_name,
			mt.mentor_company,
			mt.mentor_department,
			j.job_type,
			mt.mentor_flag,
			mm.member_profile,
			to_char(mt.mentor_logtime,'YYYY-MM-DD') mentor_logtime
	 from mentors_member mm, 
	 	  mentor mt,
	 	  job j 
	 where mm.member_email = mt.mentor_email
	 and   mt.job_code = j.job_code
	 and   mt.mentor_flag = 0
	 and   mm.member_name like '%'||#{adminmentorApplyKeyword}||'%'
	 order by mt.mentor_logtime desc)tt) 
	 <![CDATA[where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>
 
 <!-- ì´ë©˜í† ì‹ ì²­ê²€ìƒ‰ ë½‘ì•„ì˜¤ê¹…-->
 <select id="getSearchmentorApplyTotalA" resultType="Integer">
		select count(*) 
	from mentor mt,
		 mentors_member mm
	where mm.member_email = mt.mentor_email
	and   mt.mentor_flag = 0
	and   mm.member_name like '%'||#{adminmentorApplyKeyword}||'%'
</select>

<!-- ë©˜í† ì‹ ì²­ ë·°-->
 <select id="adminmentorView" parameterType="int" resultType="adminmentor">
	select mm.member_profile, mt.mentor_career, 
       mt.mentor_info, mt.mentor_businesscard,
       mm.member_name,mt.mentor_company,mt.mentor_email,mt.mentor_seq
	from mentor mt,
     mentors_member mm
	where mt.mentor_email = mm.member_email
	and mt.mentor_seq = #{mentor_seq}
 </select>

 <!-- ë©˜í† ìŠ¹ì¸ ê±°ì ˆ -->
<delete id="adminmentorReject" parameterType="java.util.Map">
	delete mentor where mentor_seq in
		<foreach collection="check" item="mentor_seq" index="i" open="(" close=")" separator=",">
			#{mentor_seq}<!-- ${check[i]} ì»¬ë ‰ì…˜ë§Œ $ë¨¹ê³  itemì¸ seqëŠ” #ê³¼$ê°™ì´ë¨¹ëŠ”ë‹¤ -->
		</foreach>
</delete>
<!-- ë©˜í†  ìŠ¹ì¸ -->
<update id="adminmentorSuccess" parameterType="java.util.Map">
	update mentor set mentor_flag = 1  where mentor_seq in 
		(select mt.mentor_seq as mentor_seq
      	from mentors_member mm,
           	 mentor mt
      	where mm.member_email = mt.mentor_email
      	and mm.member_seq in 
		<foreach collection="check" item="member_seq" index="i" open="(" close=")" separator=",">
			#{member_seq}<!-- ${check[i]} ì»¬ë ‰ì…˜ë§Œ $ë¨¹ê³  itemì¸ seqëŠ” #ê³¼$ê°™ì´ë¨¹ëŠ”ë‹¤ -->
		</foreach>
		)
</update>
<update id="adminflagMentor" parameterType="java.util.Map">
	update mentors_member set member_flag = 1 where member_seq in
		<foreach collection="check" item="member_seq" index="i" open="(" close=")" separator=",">
			#{member_seq}    <!-- ${check[i]}  ì»¬ë ‰ì…˜ë§Œ $ë¨¹ê³  itemì¸ seqëŠ” #ê³¼$ê°™ì´ë¨¹ëŠ”ë‹¤ -->
		</foreach>
</update>
<!-- ëª…ì˜ˆë©˜í†  -->
<!-- ë§¤ì¶œë½‘ì•„ì˜¤ê¸° -->
<select id="getMentorSales" resultType="adminmember.bean.AdminmentorSalesListDTO">
select  sum(tt.sales) sales,
       tt.member_name,
       tt.member_profile,
       tt.mentor_badge
from
(select mo.meetingboard_seq meetingboard_seq,
      mb.meetingboard_price sales,
       mm.member_name member_name,
       mm.member_profile member_profile,
       mt.mentor_badge mentor_badge
from meeting_order mo,
     meetingboard mb,
     mentor mt,
     mentors_member mm
where order_flag = 1
and   mo.meetingboard_seq = mb.meetingboard_seq
and   mb.mentor_email = mt.mentor_email
and   mb.mentor_email = mm.member_email)tt
group by  (tt.member_name,tt.member_profile,tt.mentor_badge)
order by sales desc
</select>

<!-- ë©˜í†  ê²Œì‹œíŒ ë½‘ì•„ì˜¤ê¸° -->
<select id="getMentorBoard"  resultType="adminmember.bean.AdminmentorBoardListDTO">
select mm.member_name,count(mm.member_name) cnt from
meetingboard mb,
mentor mt,
mentors_member mm
where mb.mentor_email = mt.mentor_email
and mt.mentor_email = mm.member_email
group by mm.member_name
order by mm.member_name
</select>

<!-- ëª…ì˜ˆë©˜í† ìŠ¹ì¸ -->
<update id="honorMentor" parameterType="java.util.Map">
	update mentor set mentor_badge = 1  where mentor_seq in
		<foreach collection="check" item="mentor_seq" index="i" open="(" close=")" separator=",">
			#{mentor_seq}<!-- ${check[i]} ì»¬ë ‰ì…˜ë§Œ $ë¨¹ê³  itemì¸ seqëŠ” #ê³¼$ê°™ì´ë¨¹ëŠ”ë‹¤ -->
		</foreach>
</update>

<!-- ë©˜í‹°ë½‘ì•„ì˜¤ê¹… -->
 <select id="getAdminmenteeList" parameterType="java.util.Map" resultType="adminmember">
 	<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			member_name,
			member_nickname,
			member_email,
			member_flag,
			member_profile,
			to_char(logtime,'YYYY-MM-DD') logtime
	 from mentors_member
	 where member_flag= 2
	 order by logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>
 </select>

 <!-- ì´ë©˜í‹° -->
 <select id="getMenteeTotalA" resultType="Integer">
		select count(*) cnt from mentors_member where member_flag= 2
</select>

<!-- ë©˜í‹°ê²€ìƒ‰ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchadminmenteeList" parameterType="java.util.Map" resultType="adminmember">
<![CDATA[select * from
	(select rownum rn, tt.*from
	(select 
			member_name,
			member_nickname,
			member_email,
			member_flag,
			member_profile,
			to_char(logtime,'YYYY-MM-DD') logtime
	 from mentors_member
	 where member_flag= 2 
	 and member_name like '%'||#{adminmenteeKeyword}||'%'
	 order by logtime desc)tt) 
	 where rn >= #{startNum} and rn<=#{endNum}]]>
</select>
<!-- ë©˜í‹°ê²€ìƒ‰ ì´ ë©¤ë²„ ìˆ˜ë½‘ì•„ì˜¤ê¸° -->
<select id="getSearchmenteeTotalA" parameterType="java.util.Map" resultType="int">
select count(*) from mentors_member 
where  member_flag= 2
and	   member_name like '%'||#{adminmenteeKeyword}||'%'
</select>

<insert id="setMentorUpdateAlarm" parameterType="Integer">
	insert into myAlarm (myAlarm_seq , myAlarm_receiverEmail , myAlarm_callerNickname , myAlarm_Title , myAlarm_content)
	values
	(myAlarm_seq.nextval
	,(select mentor_email from mentor where mentor_seq = #{check})
	,'ê´€ë¦¬ì'
	,'ë©˜í†  ì‹¬ì‚¬ ì•Œë¦¼'
	, 'ê´€ë¦¬ìë‹˜ì— ì˜í•´ ë©˜í† ë¡œ ë“±ë¡ ë˜ì—ˆìŠµë‹ˆë‹¤. ì¶•í•˜ë“œë¦½ë‹ˆë‹¤ ğŸ¥³')
</insert>

<insert id="setMenteeUpdateAlarm" parameterType="Integer">
	insert into myAlarm (myAlarm_seq , myAlarm_receiverEmail , myAlarm_callerNickname , myAlarm_Title , myAlarm_content)
	values
	(myAlarm_seq.nextval
	,(select mentor_email from mentor where mentor_seq = #{check})
	,'ê´€ë¦¬ì'
	,'ë©˜í†  ì‹¬ì‚¬ ì•Œë¦¼'
	, 'ê´€ë¦¬ìë‹˜ì— ì˜í•´ ì•„ì‰½ê²Œë„ ë©˜í†  ì‹¬ì‚¬ì—ì„œ íƒˆë½í–ˆìŠµë‹ˆë‹¤.')
</insert>


</mapper>
